{
    "sourceFile": "src/utils/api.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1763993647564,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763994875647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,11 @@\n-import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n+// import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n+export const allowedOrigins = ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787']\n \n // API Response utilities for consistent handling across endpoints\n export const API = {\n   // Allowed origins sourced from Astro config and cloned for mutation safety\n-  allowedOrigins: [...configAllowedOrigins],\n+  // allowedOrigins: [...configAllowedOrigins],\n \n   // CORS headers\n   corsHeaders: {\n     \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n"
                },
                {
                    "date": 1763994914457,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,12 @@\n // import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n-export const allowedOrigins = ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787']\n+// export const allowedOrigins = ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787']\n \n // API Response utilities for consistent handling across endpoints\n export const API = {\n   // Allowed origins sourced from Astro config and cloned for mutation safety\n   // allowedOrigins: [...configAllowedOrigins],\n+  allowedOrigins: ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787'],\n \n   // CORS headers\n   corsHeaders: {\n     \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n"
                },
                {
                    "date": 1763995015512,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n+import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n // export const allowedOrigins = ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787']\n \n // API Response utilities for consistent handling across endpoints\n export const API = {\n"
                },
                {
                    "date": 1763997681679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,10 @@\n-import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n-// export const allowedOrigins = ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787']\n \n // API Response utilities for consistent handling across endpoints\n export const API = {\n   // Allowed origins sourced from Astro config and cloned for mutation safety\n   // allowedOrigins: [...configAllowedOrigins],\n-  allowedOrigins: ['https://jscss.webflow.io', 'http://localhost:4321', 'http://localhost:8787'],\n+  allowedOrigins: [import.meta.env.ORIGIN, import.meta.env.ORIGIN_DEV, 'http://localhost:4321', 'http://localhost:8787'],\n \n   // CORS headers\n   corsHeaders: {\n     \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n"
                },
                {
                    "date": 1764457365954,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,12 +4,19 @@\n   // Allowed origins sourced from Astro config and cloned for mutation safety\n   // allowedOrigins: [...configAllowedOrigins],\n   allowedOrigins: [import.meta.env.ORIGIN, import.meta.env.ORIGIN_DEV, 'http://localhost:4321', 'http://localhost:8787'],\n \n+  // Allowed origin patterns for Webflow domains\n+  allowedOriginPatterns: [\n+    /^https:\\/\\/.*\\.webflow\\.io$/,\n+    /^https:\\/\\/.*\\.webflow\\.services$/,\n+  ],\n+\n   // CORS headers\n   corsHeaders: {\n     \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n     \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n+    \"Access-Control-Allow-Credentials\": \"true\",\n     // \"Access-Control-Allow-Origin\": \"*\",\n   },\n \n   // Merge provided headers with CORS defaults and dynamic origin handling\n@@ -87,9 +94,14 @@\n   },\n \n   // Check if origin is allowed\n   isAllowedOrigin: (origin: string): boolean => {\n-    return API.allowedOrigins.includes(origin);\n+    // Check exact matches\n+    if (API.allowedOrigins.includes(origin)) {\n+      return true;\n+    }\n+    // Check pattern matches (Webflow domains)\n+    return API.allowedOriginPatterns.some(pattern => pattern.test(origin));\n   },\n \n   // Initialize API with base URL from environment\n   init: (baseUrl?: string) => {\n"
                }
            ],
            "date": 1763993647564,
            "name": "Commit-0",
            "content": "import { allowedOrigins as configAllowedOrigins } from \"../../astro.config.mjs\";\n\n// API Response utilities for consistent handling across endpoints\nexport const API = {\n  // Allowed origins sourced from Astro config and cloned for mutation safety\n  allowedOrigins: [...configAllowedOrigins],\n\n  // CORS headers\n  corsHeaders: {\n    \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n    // \"Access-Control-Allow-Origin\": \"*\",\n  },\n\n  // Merge provided headers with CORS defaults and dynamic origin handling\n  withCorsHeaders: (\n    request?: Request,\n    extraHeaders: Record<string, string> = {}\n  ): Record<string, string> => {\n    const headers: Record<string, string> = {\n      ...API.corsHeaders,\n      ...extraHeaders,\n    };\n\n    if (request) {\n      const origin = request.headers.get(\"Origin\");\n      if (origin && API.isAllowedOrigin(origin)) {\n        headers[\"Access-Control-Allow-Origin\"] = origin;\n      }\n    }\n\n    return headers;\n  },\n\n  // Create JSON response with automatic CORS origin handling\n  json: (data: any, request?: Request, status: number = 200) => {\n    return new Response(JSON.stringify(data), {\n      status,\n      headers: API.withCorsHeaders(request, {\n        \"Content-Type\": \"application/json\",\n      }),\n    });\n  },\n\n  // Create error response\n  error: (message: string, request?: Request, status: number = 500) => {\n    return API.json({ error: message }, request, status);\n  },\n\n  // Create success response\n  success: (data: any, request?: Request) => {\n    return API.json({ success: true, ...data }, request);\n  },\n\n  // Handle CORS preflight with dynamic origin\n  cors: (request?: Request) => {\n    if (request) {\n      const origin = request.headers.get(\"Origin\");\n      console.log(\"CORS check - Request origin:\", origin);\n      console.log(\"CORS check - Allowed origins:\", API.allowedOrigins);\n      console.log(\n        \"CORS check - Is allowed:\",\n        API.isAllowedOrigin(origin || \"\")\n      );\n\n      if (origin && API.isAllowedOrigin(origin)) {\n        console.log(\"CORS check - Allowing origin:\", origin);\n        return new Response(null, {\n          status: 200,\n          headers: API.withCorsHeaders(request),\n        });\n      }\n    }\n\n    console.log(\"CORS check - Using default headers\");\n    return new Response(null, {\n      status: 200,\n      headers: API.withCorsHeaders(),\n    });\n  },\n\n  // Add origin to allowed list\n  addOrigin: (origin: string) => {\n    if (!API.allowedOrigins.includes(origin)) {\n      API.allowedOrigins.push(origin);\n    }\n  },\n\n  // Check if origin is allowed\n  isAllowedOrigin: (origin: string): boolean => {\n    return API.allowedOrigins.includes(origin);\n  },\n\n  // Initialize API with base URL from environment\n  init: (baseUrl?: string) => {\n    console.log(\"API.init called with baseUrl:\", baseUrl);\n    console.log(\"Initial allowed origins:\", API.allowedOrigins);\n\n    // Add the base URL to allowed origins if provided\n    if (baseUrl && !API.allowedOrigins.includes(baseUrl)) {\n      console.log(\"Adding baseUrl to allowed origins:\", baseUrl);\n      API.addOrigin(baseUrl);\n    }\n\n    console.log(\"Final allowed origins:\", API.allowedOrigins);\n  },\n\n  // Create API route handler with automatic CORS\n  route: (handler: (request: Request, locals: any) => Promise<Response>) => {\n    return async ({ request, locals }: { request: Request; locals: any }) => {\n      // Handle CORS preflight\n      if (request.method === \"OPTIONS\") {\n        return API.cors(request);\n      }\n\n      try {\n        return await handler(request, locals);\n      } catch (error) {\n        console.error(\"API Error:\", error);\n        return API.error(\"Internal server error\", request, 500);\n      }\n    };\n  },\n};\n"
        }
    ]
}