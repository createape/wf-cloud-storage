{
    "sourceFile": "src/lib/auth-guard.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764443175326,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764443175326,
            "name": "Commit-0",
            "content": "import type { APIContext } from \"astro\";\r\nimport { createAuth } from \"./auth\";\r\n\r\n/**\r\n * Check if the request has a valid session.\r\n * Returns the session if authenticated, null otherwise.\r\n */\r\nexport async function getSession(context: APIContext) {\r\n  const env = (context.locals.runtime as any).env;\r\n\r\n  try {\r\n    const auth = createAuth({\r\n      GOOGLE_CLIENT_ID: env.GOOGLE_CLIENT_ID,\r\n      GOOGLE_CLIENT_SECRET: env.GOOGLE_CLIENT_SECRET,\r\n      BETTER_AUTH_SECRET: env.BETTER_AUTH_SECRET,\r\n      ORIGIN: env.ORIGIN,\r\n    });\r\n\r\n    const session = await auth.api.getSession({\r\n      headers: context.request.headers,\r\n    });\r\n\r\n    return session;\r\n  } catch (error) {\r\n    console.error(\"Session check error:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Require authentication for an API route.\r\n * Returns a 401 response if not authenticated.\r\n */\r\nexport async function requireAuth(context: APIContext): Promise<Response | null> {\r\n  const session = await getSession(context);\r\n\r\n  if (!session) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n\r\n  return null; // Authenticated, proceed\r\n}\r\n"
        }
    ]
}