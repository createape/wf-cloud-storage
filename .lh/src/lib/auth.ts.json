{
    "sourceFile": "src/lib/auth.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1764344487117,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764348647732,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n import { betterAuth } from \"better-auth\";\r\n \r\n+\r\n export const auth = betterAuth({\r\n     // Stateless mode - no database configuration\r\n     // Sessions are stored in cookies only\r\n     socialProviders: {\r\n"
                },
                {
                    "date": 1764363732011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,30 +1,88 @@\n+// import { betterAuth } from \"better-auth\";\r\n+\r\n+// type AuthInstance = ReturnType<typeof betterAuth>;\r\n+\r\n+// let cachedAuth: AuthInstance | undefined;\r\n+\r\n+// const createAuth = (env: Env): AuthInstance =>\r\n+//     betterAuth({\r\n+//         baseURL: env.BETTER_AUTH_URL || env.PUBLIC_BETTER_AUTH_URL || \"http://localhost:4321/ca/api/auth\",\r\n+//         basePath: \"/ca/api/auth\",\r\n+//         // Stateless mode - no database configuration (cookies only)\r\n+//         socialProviders: {\r\n+//             google: {\r\n+//                 clientId: env.GOOGLE_CLIENT_ID || \"\",\r\n+//                 clientSecret: env.GOOGLE_CLIENT_SECRET || \"\",\r\n+//             },\r\n+//         },\r\n+//         secret: env.BETTER_AUTH_SECRET,\r\n+//         trustedOrigins: [\r\n+//             env.ORIGIN || env.ORIGIN_DEV || \"http://localhost:4321\",\r\n+//         ],\r\n+//     });\r\n+\r\n+// export const getAuth = (env: Env): AuthInstance => {\r\n+//     if (!cachedAuth) {\r\n+//         cachedAuth = createAuth(env);\r\n+//     }\r\n+\r\n+//     return cachedAuth;\r\n+// };\r\n+\r\n import { betterAuth } from \"better-auth\";\r\n \r\n type AuthInstance = ReturnType<typeof betterAuth>;\r\n \r\n+// Whatever your Env shape is, make sure these exist:\r\n+type Env = {\r\n+    GOOGLE_CLIENT_ID?: string;\r\n+    GOOGLE_CLIENT_SECRET?: string;\r\n+    BETTER_AUTH_SECRET?: string;\r\n+    BETTER_AUTH_URL?: string;\r\n+    PUBLIC_BETTER_AUTH_URL?: string;\r\n+    ORIGIN?: string;\r\n+    ORIGIN_DEV?: string;\r\n+};\r\n+\r\n let cachedAuth: AuthInstance | undefined;\r\n \r\n-const createAuth = (env: Env): AuthInstance =>\r\n-    betterAuth({\r\n-        baseURL: env.BETTER_AUTH_URL || env.PUBLIC_BETTER_AUTH_URL || \"http://localhost:4321/ca/api/auth\",\r\n+const createAuth = (rawEnv?: Env): AuthInstance => {\r\n+    const env = rawEnv ?? {};\r\n+\r\n+    // Force a baseURL so Google redirect uses jscss.webflow.io\r\n+    const baseURL =\r\n+        env.BETTER_AUTH_URL ||\r\n+        env.PUBLIC_BETTER_AUTH_URL ||\r\n+        \"http://localhost:4321/ca/api/auth\";\r\n+\r\n+    // Make sure secret is *never* empty in prod to avoid Better Auth throwing\r\n+    const secret =\r\n+        env.BETTER_AUTH_SECRET || \"better-auth-secret-123456789\"; // TODO: set a real secret in Webflow Cloud\r\n+\r\n+    return betterAuth({\r\n+        baseURL,\r\n+        // basePath is fine; if baseURL already has /ca/api/auth, Better Auth will let baseURL win\r\n         basePath: \"/ca/api/auth\",\r\n+\r\n         // Stateless mode - no database configuration (cookies only)\r\n         socialProviders: {\r\n             google: {\r\n                 clientId: env.GOOGLE_CLIENT_ID || \"\",\r\n                 clientSecret: env.GOOGLE_CLIENT_SECRET || \"\",\r\n             },\r\n         },\r\n-        secret: env.BETTER_AUTH_SECRET,\r\n+\r\n+        secret,\r\n+\r\n         trustedOrigins: [\r\n             env.ORIGIN || env.ORIGIN_DEV || \"http://localhost:4321\",\r\n         ],\r\n     });\r\n+};\r\n \r\n-export const getAuth = (env: Env): AuthInstance => {\r\n+export const getAuth = (env?: Env): AuthInstance => {\r\n     if (!cachedAuth) {\r\n         cachedAuth = createAuth(env);\r\n     }\r\n-\r\n     return cachedAuth;\r\n };\r\n"
                }
            ],
            "date": 1764344487117,
            "name": "Commit-0",
            "content": "import { betterAuth } from \"better-auth\";\r\n\r\nexport const auth = betterAuth({\r\n  // Stateless mode - no database configuration\r\n  // Sessions are stored in cookies only\r\n  socialProviders: {\r\n    google: {\r\n      clientId: import.meta.env.GOOGLE_CLIENT_ID || \"\",\r\n      clientSecret: import.meta.env.GOOGLE_CLIENT_SECRET || \"\",\r\n    },\r\n  },\r\n  secret: import.meta.env.BETTER_AUTH_SECRET,\r\n  basePath: \"/ca/api/auth\",\r\n  trustedOrigins: [\r\n    import.meta.env.ORIGIN || \"http://localhost:4321\",\r\n  ],\r\n});\r\n"
        }
    ]
}