{
    "sourceFile": "src/pages/api/delete.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764368626085,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764368626085,
            "name": "Commit-0",
            "content": "import type { APIRoute } from \"astro\";\r\nimport { API } from \"../../utils/api\";\r\n\r\nexport const DELETE: APIRoute = async ({ request, locals }) => {\r\n    // Set the origin for the API\r\n    API.init((locals.runtime as any).env.ORIGIN);\r\n\r\n    // Handle CORS preflight requests\r\n    if (request.method === \"OPTIONS\") {\r\n        console.log(\"CORS preflight request from:\", request.headers.get(\"Origin\"));\r\n        return API.cors(request);\r\n    }\r\n\r\n    try {\r\n        // Check if bucket is available\r\n        const bucket = locals.runtime.env.CLOUD_FILES;\r\n        if (!bucket) {\r\n            return API.error(\"Cloud storage not configured\", request, 500);\r\n        }\r\n\r\n        const { key } = await request.json();\r\n\r\n        if (!key || typeof key !== \"string\") {\r\n            return API.error(\"Missing or invalid file key\", request, 400);\r\n        }\r\n\r\n        // Delete from R2 bucket\r\n        await bucket.delete(key);\r\n\r\n        return API.success(\r\n            {\r\n                success: true,\r\n                key,\r\n                message: \"File deleted successfully\",\r\n            },\r\n            request\r\n        );\r\n    } catch (error) {\r\n        console.error(\"Delete error:\", error);\r\n        return API.error(\"Delete failed\", request, 500);\r\n    }\r\n};\r\n"
        }
    ]
}