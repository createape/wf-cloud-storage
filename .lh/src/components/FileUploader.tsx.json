{
    "sourceFile": "src/components/FileUploader.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763941296745,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764368626076,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,386 +1,404 @@\n-import { useState, useEffect, useRef, type ChangeEvent } from \"react\";\n+import { useState, useEffect, useRef, type ChangeEvent } from 'react'\n \n interface FileData {\n-  name?: string;\n-  dateUploaded?: string;\n-  link?: string;\n-  key?: string;\n-  uploaded?: string;\n+  name?: string\n+  dateUploaded?: string\n+  link?: string\n+  key?: string\n+  uploaded?: string\n   httpMetadata?: {\n-    contentType?: string;\n-  };\n+    contentType?: string\n+  }\n }\n \n export default function FileUploader() {\n-  const [isUploading, setIsUploading] = useState(false);\n-  const [progress, setProgress] = useState(0);\n-  const [files, setFiles] = useState<FileData[]>([]);\n-  const [loading, setLoading] = useState(true);\n-  const [uploadMode, setUploadMode] = useState<\"simple\" | \"multipart\">(\n-    \"simple\"\n-  );\n-  const [reuploadingKey, setReuploadingKey] = useState<string | null>(null);\n-  const [pendingReuploadKey, setPendingReuploadKey] = useState<string | null>(\n-    null\n-  );\n-  const [pendingReuploadMode, setPendingReuploadMode] = useState<\n-    \"simple\" | \"multipart\"\n-  >(\"simple\");\n-  const reuploadInputRef = useRef<HTMLInputElement | null>(null);\n+  const [isUploading, setIsUploading] = useState(false)\n+  const [progress, setProgress] = useState(0)\n+  const [files, setFiles] = useState<FileData[]>([])\n+  const [loading, setLoading] = useState(true)\n+  const [uploadMode, setUploadMode] = useState<'simple' | 'multipart'>('simple')\n+  const [reuploadingKey, setReuploadingKey] = useState<string | null>(null)\n+  const [pendingReuploadKey, setPendingReuploadKey] = useState<string | null>(null)\n+  const [pendingReuploadMode, setPendingReuploadMode] = useState<'simple' | 'multipart'>('simple')\n+  const [deletingKey, setDeletingKey] = useState<string | null>(null)\n+  const reuploadInputRef = useRef<HTMLInputElement | null>(null)\n \n   // File type icons mapping\n   const fileIcons: Record<string, string> = {\n-    pdf: \"üìÑ\",\n-    doc: \"üìù\",\n-    docx: \"üìù\",\n-    txt: \"üìÑ\",\n-    zip: \"üì¶\",\n-    rar: \"üì¶\",\n-    video: \"üé•\",\n-    audio: \"üéµ\",\n-    default: \"üìé\",\n-  };\n+    pdf: 'üìÑ',\n+    doc: 'üìù',\n+    docx: 'üìù',\n+    txt: 'üìÑ',\n+    zip: 'üì¶',\n+    rar: 'üì¶',\n+    video: 'üé•',\n+    audio: 'üéµ',\n+    default: 'üìé',\n+  }\n \n   // Get file icon based on type\n   const getFileIcon = (filename: string): string => {\n-    const ext = filename.split(\".\").pop()?.toLowerCase();\n+    const ext = filename.split('.').pop()?.toLowerCase()\n     if (ext && fileIcons[ext]) {\n-      return fileIcons[ext];\n+      return fileIcons[ext]\n     }\n \n     if (filename.match(/\\.(mp4|avi|mov|wmv|flv|webm|mkv)$/i)) {\n-      return fileIcons.video;\n+      return fileIcons.video\n     }\n     if (filename.match(/\\.(mp3|wav|flac|aac|ogg|wma)$/i)) {\n-      return fileIcons.audio;\n+      return fileIcons.audio\n     }\n \n-    return fileIcons.default;\n-  };\n+    return fileIcons.default\n+  }\n \n   // Format date\n   const formatDate = (dateString: string): string => {\n-    return new Date(dateString).toLocaleDateString(\"en-US\", {\n-      year: \"numeric\",\n-      month: \"short\",\n-      day: \"numeric\",\n-      hour: \"2-digit\",\n-      minute: \"2-digit\",\n-    });\n-  };\n+    return new Date(dateString).toLocaleDateString('en-US', {\n+      year: 'numeric',\n+      month: 'short',\n+      day: 'numeric',\n+      hour: '2-digit',\n+      minute: '2-digit',\n+    })\n+  }\n \n   // Check if file is an image\n   const isImage = (filename: string): boolean => {\n-    return filename.match(/\\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i) !== null;\n-  };\n+    return filename.match(/\\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i) !== null\n+  }\n \n   // Load uploaded files\n   const loadFiles = async () => {\n     try {\n-      setLoading(true);\n-      const response = await fetch(`${import.meta.env.BASE_URL}/api/list-assets`);\n+      setLoading(true)\n+      const response = await fetch(`${import.meta.env.BASE_URL}/api/list-assets`)\n \n       if (!response.ok) {\n-        throw new Error(\"Failed to load files\");\n+        throw new Error('Failed to load files')\n       }\n \n-      const fileData = (await response.json()) as FileData[];\n+      const fileData = (await response.json()) as FileData[]\n \n       // Remove duplicates based on file key/name\n       const uniqueFiles = fileData.filter((file, index, self) => {\n-        const fileKey = file.key || file.name;\n-        return (\n-          fileKey &&\n-          index === self.findIndex((f) => (f.key || f.name) === fileKey)\n-        );\n-      });\n+        const fileKey = file.key || file.name\n+        return fileKey && index === self.findIndex((f) => (f.key || f.name) === fileKey)\n+      })\n \n-      setFiles(uniqueFiles);\n+      setFiles(uniqueFiles)\n     } catch (error) {\n-      console.error(\"Error loading files:\", error);\n-      setFiles([]);\n+      console.error('Error loading files:', error)\n+      setFiles([])\n     } finally {\n-      setLoading(false);\n+      setLoading(false)\n     }\n-  };\n+  }\n \n   // Load files on component mount\n   useEffect(() => {\n-    loadFiles();\n-  }, []);\n+    loadFiles()\n+  }, [])\n \n   const simpleUploadRequest = async (file: File, keyOverride?: string) => {\n-    const formData = new FormData();\n-    formData.append(\"file\", file);\n+    const formData = new FormData()\n+    formData.append('file', file)\n     if (keyOverride) {\n-      formData.append(\"key\", keyOverride);\n+      formData.append('key', keyOverride)\n     }\n \n     const response = await fetch(`${import.meta.env.BASE_URL}/api/upload`, {\n-      method: \"POST\",\n+      method: 'POST',\n       body: formData,\n-    });\n+    })\n \n     if (!response.ok) {\n-      const errorMessage = await response.text();\n-      throw new Error(errorMessage || \"Upload failed\");\n+      const errorMessage = await response.text()\n+      throw new Error(errorMessage || 'Upload failed')\n     }\n \n-    return response.json();\n-  };\n+    return response.json()\n+  }\n \n   const multipartUploadRequest = async (\n     file: File,\n     options: {\n-      keyOverride?: string;\n-      onProgress?: (value: number) => void;\n+      keyOverride?: string\n+      onProgress?: (value: number) => void\n     } = {}\n   ) => {\n-    const assetsPrefix = import.meta.env.ASSETS_PREFIX || \"\";\n-    const BASE_CF_URL = `${assetsPrefix}/api/multipart-upload`;\n-    const key = options.keyOverride || file.name;\n-    const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB\n-    const totalParts = Math.ceil(file.size / CHUNK_SIZE);\n-    const updateProgress = options.onProgress || (() => {});\n+    const assetsPrefix = import.meta.env.ASSETS_PREFIX || ''\n+    const BASE_CF_URL = `${assetsPrefix}/api/multipart-upload`\n+    const key = options.keyOverride || file.name\n+    const CHUNK_SIZE = 5 * 1024 * 1024 // 5MB\n+    const totalParts = Math.ceil(file.size / CHUNK_SIZE)\n+    const updateProgress = options.onProgress || (() => {})\n \n     // Step 1: Initiate upload\n-    const createUploadUrl = new URL(BASE_CF_URL, window.location.origin);\n-    createUploadUrl.searchParams.append(\"action\", \"create\");\n+    const createUploadUrl = new URL(BASE_CF_URL, window.location.origin)\n+    createUploadUrl.searchParams.append('action', 'create')\n \n     const createResponse = await fetch(createUploadUrl, {\n-      method: \"POST\",\n-      headers: { \"Content-Type\": \"application/json\" },\n+      method: 'POST',\n+      headers: { 'Content-Type': 'application/json' },\n       body: JSON.stringify({ key, contentType: file.type }),\n-    });\n+    })\n \n     if (!createResponse.ok) {\n-      throw new Error(\"Failed to initiate multipart upload\");\n+      throw new Error('Failed to initiate multipart upload')\n     }\n \n-    const createJson = (await createResponse.json()) as { uploadId: string };\n-    const uploadId = createJson.uploadId;\n+    const createJson = (await createResponse.json()) as { uploadId: string }\n+    const uploadId = createJson.uploadId\n \n     // Step 2: Upload parts\n-    const partsData: { partNumber: number; etag: string }[] = [];\n-    const uploadPartUrl = new URL(BASE_CF_URL, window.location.origin);\n-    uploadPartUrl.searchParams.append(\"action\", \"upload-part\");\n-    uploadPartUrl.searchParams.append(\"uploadId\", uploadId);\n-    uploadPartUrl.searchParams.append(\"key\", key);\n+    const partsData: { partNumber: number; etag: string }[] = []\n+    const uploadPartUrl = new URL(BASE_CF_URL, window.location.origin)\n+    uploadPartUrl.searchParams.append('action', 'upload-part')\n+    uploadPartUrl.searchParams.append('uploadId', uploadId)\n+    uploadPartUrl.searchParams.append('key', key)\n \n     for (let i = 0; i < totalParts; i++) {\n-      const start = CHUNK_SIZE * i;\n-      const end = Math.min(file.size, start + CHUNK_SIZE);\n-      const blob = file.slice(start, end);\n-      const partNumber = i + 1;\n+      const start = CHUNK_SIZE * i\n+      const end = Math.min(file.size, start + CHUNK_SIZE)\n+      const blob = file.slice(start, end)\n+      const partNumber = i + 1\n \n-      uploadPartUrl.searchParams.set(\"partNumber\", partNumber.toString());\n+      uploadPartUrl.searchParams.set('partNumber', partNumber.toString())\n \n       const uploadPartResponse = await fetch(uploadPartUrl, {\n-        method: \"PUT\",\n+        method: 'PUT',\n         body: blob,\n-      });\n+      })\n \n       if (!uploadPartResponse.ok) {\n-        throw new Error(`Failed to upload part ${partNumber}`);\n+        throw new Error(`Failed to upload part ${partNumber}`)\n       }\n \n       const uploadPartJson = (await uploadPartResponse.json()) as {\n-        etag: string;\n-      };\n-      const eTag = uploadPartJson.etag;\n+        etag: string\n+      }\n+      const eTag = uploadPartJson.etag\n \n-      partsData.push({ partNumber: partNumber, etag: eTag });\n+      partsData.push({ partNumber: partNumber, etag: eTag })\n \n       // Update progress\n-      const currentProgress = ((i + 1) / totalParts) * 100;\n-      updateProgress(currentProgress);\n+      const currentProgress = ((i + 1) / totalParts) * 100\n+      updateProgress(currentProgress)\n     }\n \n     // Step 3: Complete upload\n-    const completeUploadUrl = new URL(BASE_CF_URL, window.location.origin);\n-    completeUploadUrl.searchParams.append(\"action\", \"complete\");\n+    const completeUploadUrl = new URL(BASE_CF_URL, window.location.origin)\n+    completeUploadUrl.searchParams.append('action', 'complete')\n \n     const completeResponse = await fetch(completeUploadUrl, {\n-      method: \"POST\",\n-      headers: { \"Content-Type\": \"application/json\" },\n+      method: 'POST',\n+      headers: { 'Content-Type': 'application/json' },\n       body: JSON.stringify({\n         uploadId,\n         key,\n         parts: partsData.map((part) => ({\n           partNumber: part.partNumber,\n           etag: part.etag,\n         })),\n       }),\n-    });\n+    })\n \n     if (!completeResponse.ok) {\n-      throw new Error(`Complete upload failed: ${completeResponse.status}`);\n+      throw new Error(`Complete upload failed: ${completeResponse.status}`)\n     }\n \n-    return completeResponse.json();\n-  };\n+    return completeResponse.json()\n+  }\n \n   // Simple upload function\n   const uploadFileSimple = async () => {\n-    const fileInput = document.getElementById(\"fileUpload\") as HTMLInputElement;\n-    const file = fileInput?.files?.[0];\n+    const fileInput = document.getElementById('fileUpload') as HTMLInputElement\n+    const file = fileInput?.files?.[0]\n \n     if (!file) {\n-      alert(\"Please select a file first\");\n-      return;\n+      alert('Please select a file first')\n+      return\n     }\n \n-    setIsUploading(true);\n-    setProgress(0);\n+    setIsUploading(true)\n+    setProgress(0)\n \n     try {\n-      await simpleUploadRequest(file);\n-      setProgress(100);\n-      alert(\"File uploaded successfully!\");\n-      await loadFiles();\n+      await simpleUploadRequest(file)\n+      setProgress(100)\n+      alert('File uploaded successfully!')\n+      await loadFiles()\n     } catch (error) {\n-      console.error(\"Upload failed:\", error);\n-      alert(\"Upload failed. Please try again.\");\n+      console.error('Upload failed:', error)\n+      alert('Upload failed. Please try again.')\n     } finally {\n-      setIsUploading(false);\n-      setProgress(0);\n+      setIsUploading(false)\n+      setProgress(0)\n     }\n-  };\n+  }\n \n   // Multipart upload function\n   const uploadFileMultipart = async () => {\n-    const fileInput = document.getElementById(\"fileUpload\") as HTMLInputElement;\n-    const file = fileInput?.files?.[0];\n+    const fileInput = document.getElementById('fileUpload') as HTMLInputElement\n+    const file = fileInput?.files?.[0]\n \n     if (!file) {\n-      alert(\"Please select a file first\");\n-      return;\n+      alert('Please select a file first')\n+      return\n     }\n \n-    setIsUploading(true);\n-    setProgress(0);\n+    setIsUploading(true)\n+    setProgress(0)\n \n     try {\n-      await multipartUploadRequest(file, { onProgress: setProgress });\n-      alert(\"File uploaded successfully!\");\n-      await loadFiles();\n+      await multipartUploadRequest(file, { onProgress: setProgress })\n+      alert('File uploaded successfully!')\n+      await loadFiles()\n     } catch (error) {\n-      console.error(\"Upload failed:\", error);\n-      alert(\"Upload failed. Please try again.\");\n+      console.error('Upload failed:', error)\n+      alert('Upload failed. Please try again.')\n     } finally {\n-      setIsUploading(false);\n-      setProgress(0);\n+      setIsUploading(false)\n+      setProgress(0)\n     }\n-  };\n+  }\n \n-  const handleReuploadSelection = async (\n-    event: ChangeEvent<HTMLInputElement>\n-  ) => {\n-    const file = event.target.files?.[0];\n+  const handleReuploadSelection = async (event: ChangeEvent<HTMLInputElement>) => {\n+    const file = event.target.files?.[0]\n     if (!file || !pendingReuploadKey) {\n-      setPendingReuploadKey(null);\n-      return;\n+      setPendingReuploadKey(null)\n+      return\n     }\n \n-    const keyToOverwrite = pendingReuploadKey;\n-    const modeToUse = pendingReuploadMode;\n-    event.target.value = \"\";\n-    setReuploadingKey(keyToOverwrite);\n+    const keyToOverwrite = pendingReuploadKey\n+    const modeToUse = pendingReuploadMode\n+    event.target.value = ''\n+    setReuploadingKey(keyToOverwrite)\n \n     try {\n-      if (modeToUse === \"simple\") {\n-        await simpleUploadRequest(file, keyToOverwrite);\n+      if (modeToUse === 'simple') {\n+        await simpleUploadRequest(file, keyToOverwrite)\n       } else {\n-        await multipartUploadRequest(file, { keyOverride: keyToOverwrite });\n+        await multipartUploadRequest(file, { keyOverride: keyToOverwrite })\n       }\n \n-      alert(\"File replaced successfully!\");\n-      await loadFiles();\n+      alert('File replaced successfully!')\n+      await loadFiles()\n     } catch (error) {\n-      console.error(\"Reupload failed:\", error);\n-      alert(\"Failed to reupload file. Please try again.\");\n+      console.error('Reupload failed:', error)\n+      alert('Failed to reupload file. Please try again.')\n     } finally {\n-      setReuploadingKey(null);\n-      setPendingReuploadKey(null);\n+      setReuploadingKey(null)\n+      setPendingReuploadKey(null)\n       if (reuploadInputRef.current) {\n-        reuploadInputRef.current.value = \"\";\n+        reuploadInputRef.current.value = ''\n       }\n     }\n-  };\n+  }\n \n   const triggerReuploadPicker = (fileKey: string) => {\n     if (reuploadingKey) {\n-      return;\n+      return\n     }\n-    setPendingReuploadKey(fileKey);\n-    setPendingReuploadMode(uploadMode);\n+    setPendingReuploadKey(fileKey)\n+    setPendingReuploadMode(uploadMode)\n     if (reuploadInputRef.current) {\n-      reuploadInputRef.current.value = \"\";\n-      reuploadInputRef.current.click();\n+      reuploadInputRef.current.value = ''\n+      reuploadInputRef.current.click()\n     }\n-  };\n+  }\n \n-  const uploadFile =\n-    uploadMode === \"simple\" ? uploadFileSimple : uploadFileMultipart;\n+  const handleDelete = async (fileKey: string) => {\n+    if (deletingKey) {\n+      return\n+    }\n \n+    if (!confirm(`Are you sure you want to delete \"${fileKey}\"?`)) {\n+      return\n+    }\n+\n+    setDeletingKey(fileKey)\n+\n+    try {\n+      const response = await fetch(`${import.meta.env.BASE_URL}/api/delete`, {\n+        method: 'DELETE',\n+        headers: {\n+          'Content-Type': 'application/json',\n+        },\n+        body: JSON.stringify({ key: fileKey }),\n+      })\n+\n+      if (!response.ok) {\n+        throw new Error('Failed to delete file')\n+      }\n+\n+      alert('File deleted successfully!')\n+      await loadFiles()\n+    } catch (error) {\n+      console.error('Delete failed:', error)\n+      alert('Failed to delete file. Please try again.')\n+    } finally {\n+      setDeletingKey(null)\n+    }\n+  }\n+\n+  const uploadFile = uploadMode === 'simple' ? uploadFileSimple : uploadFileMultipart\n+\n   return (\n-    <div style={{ padding: \"20px\", maxWidth: \"800px\", margin: \"0 auto\" }}>\n-      <input\n-        type=\"file\"\n-        ref={reuploadInputRef}\n-        style={{ display: \"none\" }}\n-        onChange={handleReuploadSelection}\n-      />\n+    <div style={{ padding: '20px', maxWidth: '800px', margin: '0 auto' }}>\n+      <input type=\"file\" ref={reuploadInputRef} style={{ display: 'none' }} onChange={handleReuploadSelection} />\n       <h2\n         style={{\n-          fontSize: \"1.8rem\",\n-          fontWeight: \"600\",\n-          marginBottom: \"1.5rem\",\n-          textAlign: \"center\",\n-          color: \"#333\",\n+          fontSize: '1.8rem',\n+          fontWeight: '600',\n+          marginBottom: '1.5rem',\n+          textAlign: 'center',\n+          color: '#333',\n         }}\n       >\n         File Upload Demo\n       </h2>\n \n       {/* Upload Mode Toggle */}\n       <div\n         style={{\n-          display: \"flex\",\n-          justifyContent: \"center\",\n-          gap: \"1rem\",\n-          marginBottom: \"2rem\",\n+          display: 'flex',\n+          justifyContent: 'center',\n+          gap: '1rem',\n+          marginBottom: '2rem',\n         }}\n       >\n         <button\n-          onClick={() => setUploadMode(\"simple\")}\n+          onClick={() => setUploadMode('simple')}\n           style={{\n-            padding: \"12px 24px\",\n-            borderRadius: \"8px\",\n-            border: \"2px solid #146ef5\",\n-            background: uploadMode === \"simple\" ? \"#146ef5\" : \"transparent\",\n-            color: uploadMode === \"simple\" ? \"white\" : \"#146ef5\",\n-            cursor: \"pointer\",\n-            fontSize: \"1rem\",\n-            fontWeight: \"600\",\n-            transition: \"all 0.3s ease\",\n+            padding: '12px 24px',\n+            borderRadius: '8px',\n+            border: '2px solid #146ef5',\n+            background: uploadMode === 'simple' ? '#146ef5' : 'transparent',\n+            color: uploadMode === 'simple' ? 'white' : '#146ef5',\n+            cursor: 'pointer',\n+            fontSize: '1rem',\n+            fontWeight: '600',\n+            transition: 'all 0.3s ease',\n           }}\n         >\n           Simple Upload\n         </button>\n         <button\n-          onClick={() => setUploadMode(\"multipart\")}\n+          onClick={() => setUploadMode('multipart')}\n           style={{\n-            padding: \"12px 24px\",\n-            borderRadius: \"8px\",\n-            border: \"2px solid #146ef5\",\n-            background: uploadMode === \"multipart\" ? \"#146ef5\" : \"transparent\",\n-            color: uploadMode === \"multipart\" ? \"white\" : \"#146ef5\",\n-            cursor: \"pointer\",\n-            fontSize: \"1rem\",\n-            fontWeight: \"600\",\n-            transition: \"all 0.3s ease\",\n+            padding: '12px 24px',\n+            borderRadius: '8px',\n+            border: '2px solid #146ef5',\n+            background: uploadMode === 'multipart' ? '#146ef5' : 'transparent',\n+            color: uploadMode === 'multipart' ? 'white' : '#146ef5',\n+            cursor: 'pointer',\n+            fontSize: '1rem',\n+            fontWeight: '600',\n+            transition: 'all 0.3s ease',\n           }}\n         >\n           Multipart Upload\n         </button>\n@@ -388,132 +406,127 @@\n \n       {/* Upload Section */}\n       <div\n         style={{\n-          marginBottom: \"2rem\",\n-          display: \"flex\",\n-          flexDirection: \"column\",\n-          gap: \"1rem\",\n+          marginBottom: '2rem',\n+          display: 'flex',\n+          flexDirection: 'column',\n+          gap: '1rem',\n         }}\n       >\n         <div\n           style={{\n-            position: \"relative\",\n-            display: \"flex\",\n-            alignItems: \"center\",\n-            gap: \"0.5rem\",\n+            position: 'relative',\n+            display: 'flex',\n+            alignItems: 'center',\n+            gap: '0.5rem',\n           }}\n         >\n           <input\n             type=\"file\"\n             id=\"fileUpload\"\n             style={{\n-              flex: \"1\",\n-              padding: \"12px 16px\",\n-              border: \"2px solid #e1e5e9\",\n-              borderRadius: \"8px\",\n-              fontSize: \"14px\",\n-              backgroundColor: \"#fff\",\n-              cursor: \"pointer\",\n-              transition: \"all 0.3s ease\",\n+              flex: '1',\n+              padding: '12px 16px',\n+              border: '2px solid #e1e5e9',\n+              borderRadius: '8px',\n+              fontSize: '14px',\n+              backgroundColor: '#fff',\n+              cursor: 'pointer',\n+              transition: 'all 0.3s ease',\n             }}\n             onFocus={(e) => {\n-              e.target.style.borderColor = \"#146ef5\";\n-              e.target.style.boxShadow = \"0 0 0 3px rgba(20, 110, 245, 0.1)\";\n+              e.target.style.borderColor = '#146ef5'\n+              e.target.style.boxShadow = '0 0 0 3px rgba(20, 110, 245, 0.1)'\n             }}\n             onBlur={(e) => {\n-              e.target.style.borderColor = \"#e1e5e9\";\n-              e.target.style.boxShadow = \"none\";\n+              e.target.style.borderColor = '#e1e5e9'\n+              e.target.style.boxShadow = 'none'\n             }}\n           />\n         </div>\n \n         <button\n           onClick={uploadFile}\n           disabled={isUploading}\n           style={{\n-            padding: \"14px 24px\",\n-            backgroundColor: isUploading ? \"#ccc\" : \"#146ef5\",\n-            color: \"white\",\n-            border: \"none\",\n-            borderRadius: \"8px\",\n-            cursor: isUploading ? \"not-allowed\" : \"pointer\",\n-            fontSize: \"16px\",\n-            fontWeight: \"600\",\n-            transition: \"all 0.3s ease\",\n-            boxShadow: isUploading\n-              ? \"none\"\n-              : \"0 2px 4px rgba(20, 110, 245, 0.2)\",\n-            transform: isUploading ? \"none\" : \"translateY(0)\",\n+            padding: '14px 24px',\n+            backgroundColor: isUploading ? '#ccc' : '#146ef5',\n+            color: 'white',\n+            border: 'none',\n+            borderRadius: '8px',\n+            cursor: isUploading ? 'not-allowed' : 'pointer',\n+            fontSize: '16px',\n+            fontWeight: '600',\n+            transition: 'all 0.3s ease',\n+            boxShadow: isUploading ? 'none' : '0 2px 4px rgba(20, 110, 245, 0.2)',\n+            transform: isUploading ? 'none' : 'translateY(0)',\n           }}\n           onMouseEnter={(e) => {\n             if (!isUploading) {\n-              e.currentTarget.style.backgroundColor = \"#2c80fd\";\n-              e.currentTarget.style.transform = \"translateY(-2px)\";\n-              e.currentTarget.style.boxShadow =\n-                \"0 4px 8px rgba(20, 110, 245, 0.3)\";\n+              e.currentTarget.style.backgroundColor = '#2c80fd'\n+              e.currentTarget.style.transform = 'translateY(-2px)'\n+              e.currentTarget.style.boxShadow = '0 4px 8px rgba(20, 110, 245, 0.3)'\n             }\n           }}\n           onMouseLeave={(e) => {\n             if (!isUploading) {\n-              e.currentTarget.style.backgroundColor = \"#146ef5\";\n-              e.currentTarget.style.transform = \"translateY(0)\";\n-              e.currentTarget.style.boxShadow =\n-                \"0 2px 4px rgba(20, 110, 245, 0.2)\";\n+              e.currentTarget.style.backgroundColor = '#146ef5'\n+              e.currentTarget.style.transform = 'translateY(0)'\n+              e.currentTarget.style.boxShadow = '0 2px 4px rgba(20, 110, 245, 0.2)'\n             }\n           }}\n         >\n           {isUploading ? (\n-            <span style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}>\n+            <span style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n               <div\n                 style={{\n-                  width: \"16px\",\n-                  height: \"16px\",\n-                  border: \"2px solid transparent\",\n-                  borderTop: \"2px solid white\",\n-                  borderRadius: \"50%\",\n-                  animation: \"spin 1s linear infinite\",\n+                  width: '16px',\n+                  height: '16px',\n+                  border: '2px solid transparent',\n+                  borderTop: '2px solid white',\n+                  borderRadius: '50%',\n+                  animation: 'spin 1s linear infinite',\n                 }}\n               ></div>\n               Uploading...\n             </span>\n           ) : (\n-            `Upload File (${uploadMode === \"simple\" ? \"Simple\" : \"Multipart\"})`\n+            `Upload File (${uploadMode === 'simple' ? 'Simple' : 'Multipart'})`\n           )}\n         </button>\n \n         {/* Upload Progress */}\n         {isUploading && (\n-          <div style={{ marginTop: \"20px\" }}>\n+          <div style={{ marginTop: '20px' }}>\n             <div\n               style={{\n-                width: \"100%\",\n-                backgroundColor: \"#f0f0f0\",\n-                borderRadius: \"8px\",\n-                overflow: \"hidden\",\n-                height: \"12px\",\n-                boxShadow: \"inset 0 1px 3px rgba(0, 0, 0, 0.1)\",\n+                width: '100%',\n+                backgroundColor: '#f0f0f0',\n+                borderRadius: '8px',\n+                overflow: 'hidden',\n+                height: '12px',\n+                boxShadow: 'inset 0 1px 3px rgba(0, 0, 0, 0.1)',\n               }}\n             >\n               <div\n                 style={{\n                   width: `${progress}%`,\n-                  height: \"100%\",\n-                  background:\n-                    \"linear-gradient(90deg, #146ef5 0%, #2c80fd 100%)\",\n-                  transition: \"width 0.3s ease\",\n-                  borderRadius: \"8px\",\n-                  boxShadow: \"0 1px 3px rgba(20, 110, 245, 0.3)\",\n+                  height: '100%',\n+                  background: 'linear-gradient(90deg, #146ef5 0%, #2c80fd 100%)',\n+                  transition: 'width 0.3s ease',\n+                  borderRadius: '8px',\n+                  boxShadow: '0 1px 3px rgba(20, 110, 245, 0.3)',\n                 }}\n               />\n             </div>\n             <p\n               style={{\n-                marginTop: \"8px\",\n-                fontSize: \"14px\",\n-                textAlign: \"center\",\n-                color: \"#666\",\n-                fontWeight: \"500\",\n+                marginTop: '8px',\n+                fontSize: '14px',\n+                textAlign: 'center',\n+                color: '#666',\n+                fontWeight: '500',\n               }}\n             >\n               Upload Progress: {Math.round(progress)}%\n             </p>\n@@ -523,27 +536,27 @@\n \n       {/* Files Gallery */}\n       <div\n         style={{\n-          border: \"1px solid #e1e5e9\",\n-          borderRadius: \"12px\",\n-          padding: \"1.5rem\",\n-          backgroundColor: \"#fafbfc\",\n+          border: '1px solid #e1e5e9',\n+          borderRadius: '12px',\n+          padding: '1.5rem',\n+          backgroundColor: '#fafbfc',\n         }}\n       >\n         <div\n           style={{\n-            display: \"flex\",\n-            justifyContent: \"space-between\",\n-            alignItems: \"center\",\n-            marginBottom: \"1rem\",\n+            display: 'flex',\n+            justifyContent: 'space-between',\n+            alignItems: 'center',\n+            marginBottom: '1rem',\n           }}\n         >\n           <h3\n             style={{\n-              fontSize: \"1.3rem\",\n-              fontWeight: \"600\",\n-              color: \"#333\",\n+              fontSize: '1.3rem',\n+              fontWeight: '600',\n+              color: '#333',\n               margin: 0,\n             }}\n           >\n             Uploaded Files\n@@ -551,171 +564,163 @@\n           <button\n             onClick={loadFiles}\n             disabled={loading}\n             style={{\n-              padding: \"8px 16px\",\n-              border: \"1px solid #146ef5\",\n-              background: \"transparent\",\n-              color: \"#146ef5\",\n-              borderRadius: \"6px\",\n-              cursor: loading ? \"not-allowed\" : \"pointer\",\n-              fontSize: \"14px\",\n-              fontWeight: \"500\",\n-              transition: \"all 0.3s ease\",\n+              padding: '8px 16px',\n+              border: '1px solid #146ef5',\n+              background: 'transparent',\n+              color: '#146ef5',\n+              borderRadius: '6px',\n+              cursor: loading ? 'not-allowed' : 'pointer',\n+              fontSize: '14px',\n+              fontWeight: '500',\n+              transition: 'all 0.3s ease',\n             }}\n           >\n-            {loading ? \"Loading...\" : \"Refresh\"}\n+            {loading ? 'Loading...' : 'Refresh'}\n           </button>\n         </div>\n \n         {loading ? (\n-          <div style={{ textAlign: \"center\", padding: \"2rem\" }}>\n+          <div style={{ textAlign: 'center', padding: '2rem' }}>\n             <div\n               style={{\n-                width: \"24px\",\n-                height: \"24px\",\n-                border: \"2px solid transparent\",\n-                borderTop: \"2px solid #146ef5\",\n-                borderRadius: \"50%\",\n-                animation: \"spin 1s linear infinite\",\n-                margin: \"0 auto 1rem\",\n+                width: '24px',\n+                height: '24px',\n+                border: '2px solid transparent',\n+                borderTop: '2px solid #146ef5',\n+                borderRadius: '50%',\n+                animation: 'spin 1s linear infinite',\n+                margin: '0 auto 1rem',\n               }}\n             ></div>\n-            <p style={{ color: \"#666\", margin: 0 }}>Loading files...</p>\n+            <p style={{ color: '#666', margin: 0 }}>Loading files...</p>\n           </div>\n         ) : files.length === 0 ? (\n-          <div style={{ textAlign: \"center\", padding: \"2rem\" }}>\n-            <div style={{ fontSize: \"3rem\", marginBottom: \"1rem\" }}>üìÅ</div>\n-            <p style={{ color: \"#666\", margin: 0 }}>No files uploaded yet</p>\n+          <div style={{ textAlign: 'center', padding: '2rem' }}>\n+            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üìÅ</div>\n+            <p style={{ color: '#666', margin: 0 }}>No files uploaded yet</p>\n             <p\n               style={{\n-                color: \"#999\",\n-                fontSize: \"0.9rem\",\n-                margin: \"0.5rem 0 0 0\",\n+                color: '#999',\n+                fontSize: '0.9rem',\n+                margin: '0.5rem 0 0 0',\n               }}\n             >\n               Upload some files to get started\n             </p>\n           </div>\n         ) : (\n           <div\n             style={{\n-              display: \"grid\",\n-              gridTemplateColumns: \"repeat(auto-fill, minmax(200px, 1fr))\",\n-              gap: \"1rem\",\n+              display: 'grid',\n+              gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',\n+              gap: '1rem',\n             }}\n           >\n             {files.map((file, index) => {\n-              const fileName = file.name || file.key || \"Unknown file\";\n-              const fileKey = file.key || file.name || `file-${index}`;\n-              const fileLink =\n-                file.link ||\n-                (file.key\n-                  ? `${import.meta.env.ASSETS_PREFIX}/api/asset?key=${file.key}`\n-                  : \"\");\n-              const uploadDate =\n-                file.dateUploaded || file.uploaded || new Date().toISOString();\n-              const isImageFile = isImage(fileName);\n+              const fileName = file.name || file.key || 'Unknown file'\n+              const fileKey = file.key || file.name || `file-${index}`\n+              const fileLink = file.link || (file.key ? `${import.meta.env.ASSETS_PREFIX}/api/asset?key=${file.key}` : '')\n+              const uploadDate = file.dateUploaded || file.uploaded || new Date().toISOString()\n+              const isImageFile = isImage(fileName)\n \n               return (\n                 <div\n                   key={fileKey}\n                   style={{\n-                    border: \"1px solid #e1e5e9\",\n-                    borderRadius: \"8px\",\n-                    overflow: \"hidden\",\n-                    backgroundColor: \"white\",\n-                    transition: \"all 0.3s ease\",\n+                    border: '1px solid #e1e5e9',\n+                    borderRadius: '8px',\n+                    overflow: 'hidden',\n+                    backgroundColor: 'white',\n+                    transition: 'all 0.3s ease',\n                   }}\n                   onMouseEnter={(e) => {\n-                    e.currentTarget.style.transform = \"translateY(-2px)\";\n-                    e.currentTarget.style.boxShadow =\n-                      \"0 4px 12px rgba(0, 0, 0, 0.1)\";\n+                    e.currentTarget.style.transform = 'translateY(-2px)'\n+                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)'\n                   }}\n                   onMouseLeave={(e) => {\n-                    e.currentTarget.style.transform = \"translateY(0)\";\n-                    e.currentTarget.style.boxShadow = \"none\";\n+                    e.currentTarget.style.transform = 'translateY(0)'\n+                    e.currentTarget.style.boxShadow = 'none'\n                   }}\n                 >\n-                  <div style={{ padding: \"1rem\" }}>\n+                  <div style={{ padding: '1rem' }}>\n                     {isImageFile ? (\n                       <img\n                         src={fileLink}\n                         alt={fileName}\n                         style={{\n-                          width: \"100%\",\n-                          height: \"120px\",\n-                          objectFit: \"cover\",\n-                          borderRadius: \"6px\",\n-                          marginBottom: \"0.5rem\",\n+                          width: '100%',\n+                          height: '120px',\n+                          objectFit: 'cover',\n+                          borderRadius: '6px',\n+                          marginBottom: '0.5rem',\n                         }}\n                       />\n                     ) : (\n                       <div\n                         style={{\n-                          display: \"flex\",\n-                          alignItems: \"center\",\n-                          justifyContent: \"center\",\n-                          height: \"120px\",\n-                          backgroundColor: \"#f8f9fa\",\n-                          borderRadius: \"6px\",\n-                          marginBottom: \"0.5rem\",\n+                          display: 'flex',\n+                          alignItems: 'center',\n+                          justifyContent: 'center',\n+                          height: '120px',\n+                          backgroundColor: '#f8f9fa',\n+                          borderRadius: '6px',\n+                          marginBottom: '0.5rem',\n                         }}\n                       >\n-                        <span style={{ fontSize: \"2rem\" }}>\n-                          {getFileIcon(fileName)}\n-                        </span>\n+                        <span style={{ fontSize: '2rem' }}>{getFileIcon(fileName)}</span>\n                       </div>\n                     )}\n                     <h4\n                       style={{\n-                        fontSize: \"0.9rem\",\n-                        fontWeight: \"600\",\n-                        margin: \"0 0 0.25rem 0\",\n-                        color: \"#333\",\n-                        overflow: \"hidden\",\n-                        textOverflow: \"ellipsis\",\n-                        whiteSpace: \"nowrap\",\n+                        fontSize: '0.9rem',\n+                        fontWeight: '600',\n+                        margin: '0 0 0.25rem 0',\n+                        color: '#333',\n+                        overflow: 'hidden',\n+                        textOverflow: 'ellipsis',\n+                        whiteSpace: 'nowrap',\n                       }}\n                     >\n                       {fileName}\n                     </h4>\n                     <p\n                       style={{\n-                        fontSize: \"0.75rem\",\n-                        color: \"#666\",\n-                        margin: \"0 0 0.5rem 0\",\n+                        fontSize: '0.75rem',\n+                        color: '#666',\n+                        margin: '0 0 0.5rem 0',\n                       }}\n                     >\n                       {formatDate(uploadDate)}\n                     </p>\n                     <div\n                       style={{\n-                        display: \"flex\",\n-                        gap: \"0.5rem\",\n-                        flexWrap: \"wrap\",\n+                        display: 'flex',\n+                        gap: '0.5rem',\n+                        flexWrap: 'wrap',\n                       }}\n                     >\n                       <a\n                         href={fileLink}\n                         target=\"_blank\"\n                         rel=\"noopener noreferrer\"\n                         style={{\n-                          display: \"inline-block\",\n-                          padding: \"6px 12px\",\n-                          backgroundColor: \"#146ef5\",\n-                          color: \"white\",\n-                          textDecoration: \"none\",\n-                          borderRadius: \"4px\",\n-                          fontSize: \"0.8rem\",\n-                          fontWeight: \"500\",\n-                          transition: \"background-color 0.3s ease\",\n+                          display: 'inline-block',\n+                          padding: '6px 12px',\n+                          backgroundColor: '#146ef5',\n+                          color: 'white',\n+                          textDecoration: 'none',\n+                          borderRadius: '4px',\n+                          fontSize: '0.8rem',\n+                          fontWeight: '500',\n+                          transition: 'background-color 0.3s ease',\n                         }}\n                         onMouseEnter={(e) => {\n-                          e.currentTarget.style.backgroundColor = \"#2c80fd\";\n+                          e.currentTarget.style.backgroundColor = '#2c80fd'\n                         }}\n                         onMouseLeave={(e) => {\n-                          e.currentTarget.style.backgroundColor = \"#146ef5\";\n+                          e.currentTarget.style.backgroundColor = '#146ef5'\n                         }}\n                       >\n                         View\n                       </a>\n@@ -723,26 +728,53 @@\n                         type=\"button\"\n                         onClick={() => triggerReuploadPicker(fileKey)}\n                         disabled={Boolean(reuploadingKey)}\n                         style={{\n-                          padding: \"6px 12px\",\n-                          borderRadius: \"4px\",\n-                          border: \"1px solid #146ef5\",\n-                          backgroundColor:\n-                            reuploadingKey === fileKey ? \"#dce7ff\" : \"white\",\n-                          color: \"#146ef5\",\n-                          fontSize: \"0.8rem\",\n-                          fontWeight: \"500\",\n-                          cursor: reuploadingKey ? \"not-allowed\" : \"pointer\",\n-                          transition: \"all 0.3s ease\",\n+                          padding: '6px 12px',\n+                          borderRadius: '4px',\n+                          border: '1px solid #146ef5',\n+                          backgroundColor: reuploadingKey === fileKey ? '#dce7ff' : 'white',\n+                          color: '#146ef5',\n+                          fontSize: '0.8rem',\n+                          fontWeight: '500',\n+                          cursor: reuploadingKey ? 'not-allowed' : 'pointer',\n+                          transition: 'all 0.3s ease',\n                         }}\n                       >\n-                        {reuploadingKey === fileKey ? \"Uploading...\" : \"Reupload\"}\n+                        {reuploadingKey === fileKey ? 'Uploading...' : 'Reupload'}\n                       </button>\n+                      <button\n+                        type=\"button\"\n+                        onClick={() => handleDelete(fileKey)}\n+                        disabled={Boolean(deletingKey)}\n+                        style={{\n+                          padding: '6px 12px',\n+                          borderRadius: '4px',\n+                          border: '1px solid #dc2626',\n+                          backgroundColor: deletingKey === fileKey ? '#fee2e2' : 'white',\n+                          color: '#dc2626',\n+                          fontSize: '0.8rem',\n+                          fontWeight: '500',\n+                          cursor: deletingKey ? 'not-allowed' : 'pointer',\n+                          transition: 'all 0.3s ease',\n+                        }}\n+                        onMouseEnter={(e) => {\n+                          if (!deletingKey) {\n+                            e.currentTarget.style.backgroundColor = '#fef2f2'\n+                          }\n+                        }}\n+                        onMouseLeave={(e) => {\n+                          if (!deletingKey) {\n+                            e.currentTarget.style.backgroundColor = deletingKey === fileKey ? '#fee2e2' : 'white'\n+                          }\n+                        }}\n+                      >\n+                        {deletingKey === fileKey ? 'Deleting...' : 'Delete'}\n+                      </button>\n                     </div>\n                   </div>\n                 </div>\n-              );\n+              )\n             })}\n           </div>\n         )}\n       </div>\n@@ -757,6 +789,6 @@\n         `,\n         }}\n       />\n     </div>\n-  );\n+  )\n }\n"
                },
                {
                    "date": 1764458185296,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,31 @@\n     contentType?: string\n   }\n }\n \n+// Helper to get auth headers for API calls\n+function getAuthHeaders(): HeadersInit {\n+  const token = typeof localStorage !== 'undefined' ? localStorage.getItem('auth_token') : null\n+  if (token) {\n+    return { Authorization: `Bearer ${token}` }\n+  }\n+  return {}\n+}\n+\n+// Helper to make authenticated fetch calls\n+async function authFetch(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n+  const authHeaders = getAuthHeaders()\n+  const headers = new Headers(init?.headers)\n+  \n+  // Add auth header if we have a token\n+  const authHeader = (authHeaders as Record<string, string>).Authorization\n+  if (authHeader) {\n+    headers.set('Authorization', authHeader)\n+  }\n+  \n+  return fetch(input, { ...init, headers })\n+}\n+\n export default function FileUploader() {\n   const [isUploading, setIsUploading] = useState(false)\n   const [progress, setProgress] = useState(0)\n   const [files, setFiles] = useState<FileData[]>([])\n@@ -72,9 +95,9 @@\n   // Load uploaded files\n   const loadFiles = async () => {\n     try {\n       setLoading(true)\n-      const response = await fetch(`${import.meta.env.BASE_URL}/api/list-assets`)\n+      const response = await authFetch(`${import.meta.env.BASE_URL}/api/list-assets`)\n \n       if (!response.ok) {\n         throw new Error('Failed to load files')\n       }\n@@ -107,9 +130,9 @@\n     if (keyOverride) {\n       formData.append('key', keyOverride)\n     }\n \n-    const response = await fetch(`${import.meta.env.BASE_URL}/api/upload`, {\n+    const response = await authFetch(`${import.meta.env.BASE_URL}/api/upload`, {\n       method: 'POST',\n       body: formData,\n     })\n \n@@ -138,9 +161,9 @@\n     // Step 1: Initiate upload\n     const createUploadUrl = new URL(BASE_CF_URL, window.location.origin)\n     createUploadUrl.searchParams.append('action', 'create')\n \n-    const createResponse = await fetch(createUploadUrl, {\n+    const createResponse = await authFetch(createUploadUrl, {\n       method: 'POST',\n       headers: { 'Content-Type': 'application/json' },\n       body: JSON.stringify({ key, contentType: file.type }),\n     })\n@@ -166,9 +189,9 @@\n       const partNumber = i + 1\n \n       uploadPartUrl.searchParams.set('partNumber', partNumber.toString())\n \n-      const uploadPartResponse = await fetch(uploadPartUrl, {\n+      const uploadPartResponse = await authFetch(uploadPartUrl, {\n         method: 'PUT',\n         body: blob,\n       })\n \n@@ -191,9 +214,9 @@\n     // Step 3: Complete upload\n     const completeUploadUrl = new URL(BASE_CF_URL, window.location.origin)\n     completeUploadUrl.searchParams.append('action', 'complete')\n \n-    const completeResponse = await fetch(completeUploadUrl, {\n+    const completeResponse = await authFetch(completeUploadUrl, {\n       method: 'POST',\n       headers: { 'Content-Type': 'application/json' },\n       body: JSON.stringify({\n         uploadId,\n@@ -321,9 +344,9 @@\n \n     setDeletingKey(fileKey)\n \n     try {\n-      const response = await fetch(`${import.meta.env.BASE_URL}/api/delete`, {\n+      const response = await authFetch(`${import.meta.env.BASE_URL}/api/delete`, {\n         method: 'DELETE',\n         headers: {\n           'Content-Type': 'application/json',\n         },\n"
                }
            ],
            "date": 1763941296745,
            "name": "Commit-0",
            "content": "import { useState, useEffect, useRef, type ChangeEvent } from \"react\";\n\ninterface FileData {\n  name?: string;\n  dateUploaded?: string;\n  link?: string;\n  key?: string;\n  uploaded?: string;\n  httpMetadata?: {\n    contentType?: string;\n  };\n}\n\nexport default function FileUploader() {\n  const [isUploading, setIsUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [files, setFiles] = useState<FileData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [uploadMode, setUploadMode] = useState<\"simple\" | \"multipart\">(\n    \"simple\"\n  );\n  const [reuploadingKey, setReuploadingKey] = useState<string | null>(null);\n  const [pendingReuploadKey, setPendingReuploadKey] = useState<string | null>(\n    null\n  );\n  const [pendingReuploadMode, setPendingReuploadMode] = useState<\n    \"simple\" | \"multipart\"\n  >(\"simple\");\n  const reuploadInputRef = useRef<HTMLInputElement | null>(null);\n\n  // File type icons mapping\n  const fileIcons: Record<string, string> = {\n    pdf: \"üìÑ\",\n    doc: \"üìù\",\n    docx: \"üìù\",\n    txt: \"üìÑ\",\n    zip: \"üì¶\",\n    rar: \"üì¶\",\n    video: \"üé•\",\n    audio: \"üéµ\",\n    default: \"üìé\",\n  };\n\n  // Get file icon based on type\n  const getFileIcon = (filename: string): string => {\n    const ext = filename.split(\".\").pop()?.toLowerCase();\n    if (ext && fileIcons[ext]) {\n      return fileIcons[ext];\n    }\n\n    if (filename.match(/\\.(mp4|avi|mov|wmv|flv|webm|mkv)$/i)) {\n      return fileIcons.video;\n    }\n    if (filename.match(/\\.(mp3|wav|flac|aac|ogg|wma)$/i)) {\n      return fileIcons.audio;\n    }\n\n    return fileIcons.default;\n  };\n\n  // Format date\n  const formatDate = (dateString: string): string => {\n    return new Date(dateString).toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  // Check if file is an image\n  const isImage = (filename: string): boolean => {\n    return filename.match(/\\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i) !== null;\n  };\n\n  // Load uploaded files\n  const loadFiles = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`${import.meta.env.BASE_URL}/api/list-assets`);\n\n      if (!response.ok) {\n        throw new Error(\"Failed to load files\");\n      }\n\n      const fileData = (await response.json()) as FileData[];\n\n      // Remove duplicates based on file key/name\n      const uniqueFiles = fileData.filter((file, index, self) => {\n        const fileKey = file.key || file.name;\n        return (\n          fileKey &&\n          index === self.findIndex((f) => (f.key || f.name) === fileKey)\n        );\n      });\n\n      setFiles(uniqueFiles);\n    } catch (error) {\n      console.error(\"Error loading files:\", error);\n      setFiles([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load files on component mount\n  useEffect(() => {\n    loadFiles();\n  }, []);\n\n  const simpleUploadRequest = async (file: File, keyOverride?: string) => {\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    if (keyOverride) {\n      formData.append(\"key\", keyOverride);\n    }\n\n    const response = await fetch(`${import.meta.env.BASE_URL}/api/upload`, {\n      method: \"POST\",\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorMessage = await response.text();\n      throw new Error(errorMessage || \"Upload failed\");\n    }\n\n    return response.json();\n  };\n\n  const multipartUploadRequest = async (\n    file: File,\n    options: {\n      keyOverride?: string;\n      onProgress?: (value: number) => void;\n    } = {}\n  ) => {\n    const assetsPrefix = import.meta.env.ASSETS_PREFIX || \"\";\n    const BASE_CF_URL = `${assetsPrefix}/api/multipart-upload`;\n    const key = options.keyOverride || file.name;\n    const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB\n    const totalParts = Math.ceil(file.size / CHUNK_SIZE);\n    const updateProgress = options.onProgress || (() => {});\n\n    // Step 1: Initiate upload\n    const createUploadUrl = new URL(BASE_CF_URL, window.location.origin);\n    createUploadUrl.searchParams.append(\"action\", \"create\");\n\n    const createResponse = await fetch(createUploadUrl, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ key, contentType: file.type }),\n    });\n\n    if (!createResponse.ok) {\n      throw new Error(\"Failed to initiate multipart upload\");\n    }\n\n    const createJson = (await createResponse.json()) as { uploadId: string };\n    const uploadId = createJson.uploadId;\n\n    // Step 2: Upload parts\n    const partsData: { partNumber: number; etag: string }[] = [];\n    const uploadPartUrl = new URL(BASE_CF_URL, window.location.origin);\n    uploadPartUrl.searchParams.append(\"action\", \"upload-part\");\n    uploadPartUrl.searchParams.append(\"uploadId\", uploadId);\n    uploadPartUrl.searchParams.append(\"key\", key);\n\n    for (let i = 0; i < totalParts; i++) {\n      const start = CHUNK_SIZE * i;\n      const end = Math.min(file.size, start + CHUNK_SIZE);\n      const blob = file.slice(start, end);\n      const partNumber = i + 1;\n\n      uploadPartUrl.searchParams.set(\"partNumber\", partNumber.toString());\n\n      const uploadPartResponse = await fetch(uploadPartUrl, {\n        method: \"PUT\",\n        body: blob,\n      });\n\n      if (!uploadPartResponse.ok) {\n        throw new Error(`Failed to upload part ${partNumber}`);\n      }\n\n      const uploadPartJson = (await uploadPartResponse.json()) as {\n        etag: string;\n      };\n      const eTag = uploadPartJson.etag;\n\n      partsData.push({ partNumber: partNumber, etag: eTag });\n\n      // Update progress\n      const currentProgress = ((i + 1) / totalParts) * 100;\n      updateProgress(currentProgress);\n    }\n\n    // Step 3: Complete upload\n    const completeUploadUrl = new URL(BASE_CF_URL, window.location.origin);\n    completeUploadUrl.searchParams.append(\"action\", \"complete\");\n\n    const completeResponse = await fetch(completeUploadUrl, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        uploadId,\n        key,\n        parts: partsData.map((part) => ({\n          partNumber: part.partNumber,\n          etag: part.etag,\n        })),\n      }),\n    });\n\n    if (!completeResponse.ok) {\n      throw new Error(`Complete upload failed: ${completeResponse.status}`);\n    }\n\n    return completeResponse.json();\n  };\n\n  // Simple upload function\n  const uploadFileSimple = async () => {\n    const fileInput = document.getElementById(\"fileUpload\") as HTMLInputElement;\n    const file = fileInput?.files?.[0];\n\n    if (!file) {\n      alert(\"Please select a file first\");\n      return;\n    }\n\n    setIsUploading(true);\n    setProgress(0);\n\n    try {\n      await simpleUploadRequest(file);\n      setProgress(100);\n      alert(\"File uploaded successfully!\");\n      await loadFiles();\n    } catch (error) {\n      console.error(\"Upload failed:\", error);\n      alert(\"Upload failed. Please try again.\");\n    } finally {\n      setIsUploading(false);\n      setProgress(0);\n    }\n  };\n\n  // Multipart upload function\n  const uploadFileMultipart = async () => {\n    const fileInput = document.getElementById(\"fileUpload\") as HTMLInputElement;\n    const file = fileInput?.files?.[0];\n\n    if (!file) {\n      alert(\"Please select a file first\");\n      return;\n    }\n\n    setIsUploading(true);\n    setProgress(0);\n\n    try {\n      await multipartUploadRequest(file, { onProgress: setProgress });\n      alert(\"File uploaded successfully!\");\n      await loadFiles();\n    } catch (error) {\n      console.error(\"Upload failed:\", error);\n      alert(\"Upload failed. Please try again.\");\n    } finally {\n      setIsUploading(false);\n      setProgress(0);\n    }\n  };\n\n  const handleReuploadSelection = async (\n    event: ChangeEvent<HTMLInputElement>\n  ) => {\n    const file = event.target.files?.[0];\n    if (!file || !pendingReuploadKey) {\n      setPendingReuploadKey(null);\n      return;\n    }\n\n    const keyToOverwrite = pendingReuploadKey;\n    const modeToUse = pendingReuploadMode;\n    event.target.value = \"\";\n    setReuploadingKey(keyToOverwrite);\n\n    try {\n      if (modeToUse === \"simple\") {\n        await simpleUploadRequest(file, keyToOverwrite);\n      } else {\n        await multipartUploadRequest(file, { keyOverride: keyToOverwrite });\n      }\n\n      alert(\"File replaced successfully!\");\n      await loadFiles();\n    } catch (error) {\n      console.error(\"Reupload failed:\", error);\n      alert(\"Failed to reupload file. Please try again.\");\n    } finally {\n      setReuploadingKey(null);\n      setPendingReuploadKey(null);\n      if (reuploadInputRef.current) {\n        reuploadInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  const triggerReuploadPicker = (fileKey: string) => {\n    if (reuploadingKey) {\n      return;\n    }\n    setPendingReuploadKey(fileKey);\n    setPendingReuploadMode(uploadMode);\n    if (reuploadInputRef.current) {\n      reuploadInputRef.current.value = \"\";\n      reuploadInputRef.current.click();\n    }\n  };\n\n  const uploadFile =\n    uploadMode === \"simple\" ? uploadFileSimple : uploadFileMultipart;\n\n  return (\n    <div style={{ padding: \"20px\", maxWidth: \"800px\", margin: \"0 auto\" }}>\n      <input\n        type=\"file\"\n        ref={reuploadInputRef}\n        style={{ display: \"none\" }}\n        onChange={handleReuploadSelection}\n      />\n      <h2\n        style={{\n          fontSize: \"1.8rem\",\n          fontWeight: \"600\",\n          marginBottom: \"1.5rem\",\n          textAlign: \"center\",\n          color: \"#333\",\n        }}\n      >\n        File Upload Demo\n      </h2>\n\n      {/* Upload Mode Toggle */}\n      <div\n        style={{\n          display: \"flex\",\n          justifyContent: \"center\",\n          gap: \"1rem\",\n          marginBottom: \"2rem\",\n        }}\n      >\n        <button\n          onClick={() => setUploadMode(\"simple\")}\n          style={{\n            padding: \"12px 24px\",\n            borderRadius: \"8px\",\n            border: \"2px solid #146ef5\",\n            background: uploadMode === \"simple\" ? \"#146ef5\" : \"transparent\",\n            color: uploadMode === \"simple\" ? \"white\" : \"#146ef5\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"600\",\n            transition: \"all 0.3s ease\",\n          }}\n        >\n          Simple Upload\n        </button>\n        <button\n          onClick={() => setUploadMode(\"multipart\")}\n          style={{\n            padding: \"12px 24px\",\n            borderRadius: \"8px\",\n            border: \"2px solid #146ef5\",\n            background: uploadMode === \"multipart\" ? \"#146ef5\" : \"transparent\",\n            color: uploadMode === \"multipart\" ? \"white\" : \"#146ef5\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"600\",\n            transition: \"all 0.3s ease\",\n          }}\n        >\n          Multipart Upload\n        </button>\n      </div>\n\n      {/* Upload Section */}\n      <div\n        style={{\n          marginBottom: \"2rem\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: \"1rem\",\n        }}\n      >\n        <div\n          style={{\n            position: \"relative\",\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: \"0.5rem\",\n          }}\n        >\n          <input\n            type=\"file\"\n            id=\"fileUpload\"\n            style={{\n              flex: \"1\",\n              padding: \"12px 16px\",\n              border: \"2px solid #e1e5e9\",\n              borderRadius: \"8px\",\n              fontSize: \"14px\",\n              backgroundColor: \"#fff\",\n              cursor: \"pointer\",\n              transition: \"all 0.3s ease\",\n            }}\n            onFocus={(e) => {\n              e.target.style.borderColor = \"#146ef5\";\n              e.target.style.boxShadow = \"0 0 0 3px rgba(20, 110, 245, 0.1)\";\n            }}\n            onBlur={(e) => {\n              e.target.style.borderColor = \"#e1e5e9\";\n              e.target.style.boxShadow = \"none\";\n            }}\n          />\n        </div>\n\n        <button\n          onClick={uploadFile}\n          disabled={isUploading}\n          style={{\n            padding: \"14px 24px\",\n            backgroundColor: isUploading ? \"#ccc\" : \"#146ef5\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"8px\",\n            cursor: isUploading ? \"not-allowed\" : \"pointer\",\n            fontSize: \"16px\",\n            fontWeight: \"600\",\n            transition: \"all 0.3s ease\",\n            boxShadow: isUploading\n              ? \"none\"\n              : \"0 2px 4px rgba(20, 110, 245, 0.2)\",\n            transform: isUploading ? \"none\" : \"translateY(0)\",\n          }}\n          onMouseEnter={(e) => {\n            if (!isUploading) {\n              e.currentTarget.style.backgroundColor = \"#2c80fd\";\n              e.currentTarget.style.transform = \"translateY(-2px)\";\n              e.currentTarget.style.boxShadow =\n                \"0 4px 8px rgba(20, 110, 245, 0.3)\";\n            }\n          }}\n          onMouseLeave={(e) => {\n            if (!isUploading) {\n              e.currentTarget.style.backgroundColor = \"#146ef5\";\n              e.currentTarget.style.transform = \"translateY(0)\";\n              e.currentTarget.style.boxShadow =\n                \"0 2px 4px rgba(20, 110, 245, 0.2)\";\n            }\n          }}\n        >\n          {isUploading ? (\n            <span style={{ display: \"flex\", alignItems: \"center\", gap: \"8px\" }}>\n              <div\n                style={{\n                  width: \"16px\",\n                  height: \"16px\",\n                  border: \"2px solid transparent\",\n                  borderTop: \"2px solid white\",\n                  borderRadius: \"50%\",\n                  animation: \"spin 1s linear infinite\",\n                }}\n              ></div>\n              Uploading...\n            </span>\n          ) : (\n            `Upload File (${uploadMode === \"simple\" ? \"Simple\" : \"Multipart\"})`\n          )}\n        </button>\n\n        {/* Upload Progress */}\n        {isUploading && (\n          <div style={{ marginTop: \"20px\" }}>\n            <div\n              style={{\n                width: \"100%\",\n                backgroundColor: \"#f0f0f0\",\n                borderRadius: \"8px\",\n                overflow: \"hidden\",\n                height: \"12px\",\n                boxShadow: \"inset 0 1px 3px rgba(0, 0, 0, 0.1)\",\n              }}\n            >\n              <div\n                style={{\n                  width: `${progress}%`,\n                  height: \"100%\",\n                  background:\n                    \"linear-gradient(90deg, #146ef5 0%, #2c80fd 100%)\",\n                  transition: \"width 0.3s ease\",\n                  borderRadius: \"8px\",\n                  boxShadow: \"0 1px 3px rgba(20, 110, 245, 0.3)\",\n                }}\n              />\n            </div>\n            <p\n              style={{\n                marginTop: \"8px\",\n                fontSize: \"14px\",\n                textAlign: \"center\",\n                color: \"#666\",\n                fontWeight: \"500\",\n              }}\n            >\n              Upload Progress: {Math.round(progress)}%\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Files Gallery */}\n      <div\n        style={{\n          border: \"1px solid #e1e5e9\",\n          borderRadius: \"12px\",\n          padding: \"1.5rem\",\n          backgroundColor: \"#fafbfc\",\n        }}\n      >\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"center\",\n            marginBottom: \"1rem\",\n          }}\n        >\n          <h3\n            style={{\n              fontSize: \"1.3rem\",\n              fontWeight: \"600\",\n              color: \"#333\",\n              margin: 0,\n            }}\n          >\n            Uploaded Files\n          </h3>\n          <button\n            onClick={loadFiles}\n            disabled={loading}\n            style={{\n              padding: \"8px 16px\",\n              border: \"1px solid #146ef5\",\n              background: \"transparent\",\n              color: \"#146ef5\",\n              borderRadius: \"6px\",\n              cursor: loading ? \"not-allowed\" : \"pointer\",\n              fontSize: \"14px\",\n              fontWeight: \"500\",\n              transition: \"all 0.3s ease\",\n            }}\n          >\n            {loading ? \"Loading...\" : \"Refresh\"}\n          </button>\n        </div>\n\n        {loading ? (\n          <div style={{ textAlign: \"center\", padding: \"2rem\" }}>\n            <div\n              style={{\n                width: \"24px\",\n                height: \"24px\",\n                border: \"2px solid transparent\",\n                borderTop: \"2px solid #146ef5\",\n                borderRadius: \"50%\",\n                animation: \"spin 1s linear infinite\",\n                margin: \"0 auto 1rem\",\n              }}\n            ></div>\n            <p style={{ color: \"#666\", margin: 0 }}>Loading files...</p>\n          </div>\n        ) : files.length === 0 ? (\n          <div style={{ textAlign: \"center\", padding: \"2rem\" }}>\n            <div style={{ fontSize: \"3rem\", marginBottom: \"1rem\" }}>üìÅ</div>\n            <p style={{ color: \"#666\", margin: 0 }}>No files uploaded yet</p>\n            <p\n              style={{\n                color: \"#999\",\n                fontSize: \"0.9rem\",\n                margin: \"0.5rem 0 0 0\",\n              }}\n            >\n              Upload some files to get started\n            </p>\n          </div>\n        ) : (\n          <div\n            style={{\n              display: \"grid\",\n              gridTemplateColumns: \"repeat(auto-fill, minmax(200px, 1fr))\",\n              gap: \"1rem\",\n            }}\n          >\n            {files.map((file, index) => {\n              const fileName = file.name || file.key || \"Unknown file\";\n              const fileKey = file.key || file.name || `file-${index}`;\n              const fileLink =\n                file.link ||\n                (file.key\n                  ? `${import.meta.env.ASSETS_PREFIX}/api/asset?key=${file.key}`\n                  : \"\");\n              const uploadDate =\n                file.dateUploaded || file.uploaded || new Date().toISOString();\n              const isImageFile = isImage(fileName);\n\n              return (\n                <div\n                  key={fileKey}\n                  style={{\n                    border: \"1px solid #e1e5e9\",\n                    borderRadius: \"8px\",\n                    overflow: \"hidden\",\n                    backgroundColor: \"white\",\n                    transition: \"all 0.3s ease\",\n                  }}\n                  onMouseEnter={(e) => {\n                    e.currentTarget.style.transform = \"translateY(-2px)\";\n                    e.currentTarget.style.boxShadow =\n                      \"0 4px 12px rgba(0, 0, 0, 0.1)\";\n                  }}\n                  onMouseLeave={(e) => {\n                    e.currentTarget.style.transform = \"translateY(0)\";\n                    e.currentTarget.style.boxShadow = \"none\";\n                  }}\n                >\n                  <div style={{ padding: \"1rem\" }}>\n                    {isImageFile ? (\n                      <img\n                        src={fileLink}\n                        alt={fileName}\n                        style={{\n                          width: \"100%\",\n                          height: \"120px\",\n                          objectFit: \"cover\",\n                          borderRadius: \"6px\",\n                          marginBottom: \"0.5rem\",\n                        }}\n                      />\n                    ) : (\n                      <div\n                        style={{\n                          display: \"flex\",\n                          alignItems: \"center\",\n                          justifyContent: \"center\",\n                          height: \"120px\",\n                          backgroundColor: \"#f8f9fa\",\n                          borderRadius: \"6px\",\n                          marginBottom: \"0.5rem\",\n                        }}\n                      >\n                        <span style={{ fontSize: \"2rem\" }}>\n                          {getFileIcon(fileName)}\n                        </span>\n                      </div>\n                    )}\n                    <h4\n                      style={{\n                        fontSize: \"0.9rem\",\n                        fontWeight: \"600\",\n                        margin: \"0 0 0.25rem 0\",\n                        color: \"#333\",\n                        overflow: \"hidden\",\n                        textOverflow: \"ellipsis\",\n                        whiteSpace: \"nowrap\",\n                      }}\n                    >\n                      {fileName}\n                    </h4>\n                    <p\n                      style={{\n                        fontSize: \"0.75rem\",\n                        color: \"#666\",\n                        margin: \"0 0 0.5rem 0\",\n                      }}\n                    >\n                      {formatDate(uploadDate)}\n                    </p>\n                    <div\n                      style={{\n                        display: \"flex\",\n                        gap: \"0.5rem\",\n                        flexWrap: \"wrap\",\n                      }}\n                    >\n                      <a\n                        href={fileLink}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        style={{\n                          display: \"inline-block\",\n                          padding: \"6px 12px\",\n                          backgroundColor: \"#146ef5\",\n                          color: \"white\",\n                          textDecoration: \"none\",\n                          borderRadius: \"4px\",\n                          fontSize: \"0.8rem\",\n                          fontWeight: \"500\",\n                          transition: \"background-color 0.3s ease\",\n                        }}\n                        onMouseEnter={(e) => {\n                          e.currentTarget.style.backgroundColor = \"#2c80fd\";\n                        }}\n                        onMouseLeave={(e) => {\n                          e.currentTarget.style.backgroundColor = \"#146ef5\";\n                        }}\n                      >\n                        View\n                      </a>\n                      <button\n                        type=\"button\"\n                        onClick={() => triggerReuploadPicker(fileKey)}\n                        disabled={Boolean(reuploadingKey)}\n                        style={{\n                          padding: \"6px 12px\",\n                          borderRadius: \"4px\",\n                          border: \"1px solid #146ef5\",\n                          backgroundColor:\n                            reuploadingKey === fileKey ? \"#dce7ff\" : \"white\",\n                          color: \"#146ef5\",\n                          fontSize: \"0.8rem\",\n                          fontWeight: \"500\",\n                          cursor: reuploadingKey ? \"not-allowed\" : \"pointer\",\n                          transition: \"all 0.3s ease\",\n                        }}\n                      >\n                        {reuploadingKey === fileKey ? \"Uploading...\" : \"Reupload\"}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      <style\n        dangerouslySetInnerHTML={{\n          __html: `\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        `,\n        }}\n      />\n    </div>\n  );\n}\n"
        }
    ]
}